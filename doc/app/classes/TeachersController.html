<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: TeachersController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">TeachersController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/teachers_controller_rb.html">
                app/controllers/teachers_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <h1>QuiXoft - Progetto SIGEOL</h1>
<table>
<tr><td valign="top">NOME FILE:</td><td>teachers.controller.rb

</td></tr>
<tr><td valign="top">AUTORE:</td><td>Beggiato Andrea, Scortegagna Carlo

</td></tr>
<tr><td valign="top">DATA CREAZIONE:</td><td>17/02/2009

</td></tr>
<tr><td valign="top">REGISTRO DELLE MODIFICHE:</td><td>05/06/2009 aggiunta l&#8216;action <a
href="TeachersController.html#M000080">manage_constraints</a>

<p>
28/09/2009 aggiunta in <a
href="TeachersController.html#M000071">administration</a> la lista dei
docenti non associati a nessun corso di laurea
</p>
<p>
19/05/2009 sistemate le action <a
href="TeachersController.html#M000058">index</a> e <a
href="TeachersController.html#M000059">show</a> per gli utenti non loggati
</p>
<p>
12/05/2009 sia su proprity_down che su priority_up assegnato a i =
constraint_to_move_down.isHard. Usato i come indice per accedere ai valori
degli array e non piu&#8217; constraint_to_move_down.isHard(riga 292 e 323)
</p>
<p>
12/05/2009 per gli array e&#8217; stato sostituito count con size
</p>
<p>
27/04/2009 Completata la gestione delle preferenze
</p>
<p>
21/04/2009 Aggiunta la gestione dei vincoli
</p>
<p>
14/03/2009 Sistemata l&#8216;assegnazione dei docenti agli insegnamenti
</p>
<p>
29/02/2009 Aggiunta l&#8216;azione <a
href="TeachersController.html#M000071">administration</a>
</p>
<p>
17/02/2009 Aggiunto l&#8216;invito dei docenti da parte di chi ha i
permessi per farlo
</p>
</td></tr>
</table>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000070">activate</a>&nbsp;&nbsp;
      <a href="#M000071">administration</a>&nbsp;&nbsp;
      <a href="#M000065">create</a>&nbsp;&nbsp;
      <a href="#M000073">create_constraint</a>&nbsp;&nbsp;
      <a href="#M000076">create_preference</a>&nbsp;&nbsp;
      <a href="#M000066">destroy</a>&nbsp;&nbsp;
      <a href="#M000074">destroy_constraint</a>&nbsp;&nbsp;
      <a href="#M000081">destroy_constraint_from_manage_constraints</a>&nbsp;&nbsp;
      <a href="#M000077">destroy_preference</a>&nbsp;&nbsp;
      <a href="#M000067">edit</a>&nbsp;&nbsp;
      <a href="#M000061">edit_capabilities</a>&nbsp;&nbsp;
      <a href="#M000072">edit_constraints</a>&nbsp;&nbsp;
      <a href="#M000060">edit_graduate_courses</a>&nbsp;&nbsp;
      <a href="#M000075">edit_preferences</a>&nbsp;&nbsp;
      <a href="#M000058">index</a>&nbsp;&nbsp;
      <a href="#M000080">manage_constraints</a>&nbsp;&nbsp;
      <a href="#M000064">new</a>&nbsp;&nbsp;
      <a href="#M000069">pre_activate</a>&nbsp;&nbsp;
      <a href="#M000059">show</a>&nbsp;&nbsp;
      <a href="#M000079">teacher_preference_priority_down</a>&nbsp;&nbsp;
      <a href="#M000078">teacher_preference_priority_up</a>&nbsp;&nbsp;
      <a href="#M000082">transform_constraint_in_preference</a>&nbsp;&nbsp;
      <a href="#M000063">update_capabilities</a>&nbsp;&nbsp;
      <a href="#M000062">update_graduate_courses</a>&nbsp;&nbsp;
      <a href="#M000068">update_personal_data</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000070" class="method-detail">
        <a name="M000070"></a>

        <div class="method-heading">
          <a href="#M000070" class="method-signature">
          <span class="method-name">activate</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Completa la registrazione del teacher nel sistema, inserendo nel DB i dati
realtivi all&#8216;address, la password scelta e i dati personali del
docente. Nel caso di utente gia&#8217; attivo o inesistente, viene
segnalato l&#8216;errore e viene fatto un redirect alla vista <a
href="TeachersController.html#M000058">index</a> di timetables.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000070-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000070-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 262</span>
262:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">activate</span>
263:     <span class="ruby-ivar">@repeat_password</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:repeat_password</span>]
264:     <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
265:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
266:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@user</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">specified_type</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Teacher&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">active?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">digest</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:digest</span>]
267:         <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">address</span>.<span class="ruby-identifier">telephone</span>= <span class="ruby-value str">&quot;&quot;</span>
268:         <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:prefisso</span>] <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:telefono</span>] <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span>)
269:           <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">address</span>.<span class="ruby-identifier">telephone</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:prefisso</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot;-&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:telefono</span>]
270:         <span class="ruby-keyword kw">end</span>
271:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@repeat_password</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:user</span>][<span class="ruby-identifier">:password</span>]
272:           <span class="ruby-ivar">@repeat_password</span> = <span class="ruby-value">1</span>
273:         <span class="ruby-keyword kw">else</span>
274:           <span class="ruby-ivar">@repeat_password</span> = <span class="ruby-value">0</span>
275:         <span class="ruby-keyword kw">end</span>
276:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">specified</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:teacher</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">address</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:address</span>]) <span class="ruby-operator">&amp;&amp;</span>  <span class="ruby-ivar">@repeat_password</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
277:           <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">password</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:user</span>][<span class="ruby-identifier">:password</span>]
278:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">save</span>
279:             <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;Account attivato correttamente&quot;</span>
280:             <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>{<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">timetables_url</span>}
281:             <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{<span class="ruby-identifier">render</span>(<span class="ruby-identifier">:update</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">timetables_url</span>}}
282:           <span class="ruby-keyword kw">else</span>
283:             <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>{<span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:pre_activate</span>, <span class="ruby-identifier">:digest</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">digest</span>}
284:             <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{}
285:           <span class="ruby-keyword kw">end</span>
286:         <span class="ruby-keyword kw">else</span>
287:           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>{<span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:pre_activate</span>, <span class="ruby-identifier">:digest</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">digest</span>}
288:           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{}
289:         <span class="ruby-keyword kw">end</span>
290:       <span class="ruby-keyword kw">else</span>
291:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:error</span>] = <span class="ruby-value str">&quot;L'utente non esiste od è già attivo&quot;</span>
292:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>{<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">timetables_url</span>}
293:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{<span class="ruby-identifier">render</span>(<span class="ruby-identifier">:update</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">timetables_url</span>}}
294:       <span class="ruby-keyword kw">end</span>
295:     <span class="ruby-keyword kw">end</span>
296:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000071" class="method-detail">
        <a name="M000071"></a>

        <div class="method-heading">
          <a href="#M000071" class="method-signature">
          <span class="method-name">administration</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Inizializza le variabili d&#8216;istanza @not_associated_users,
@graduate_courses e @not_active_users per la vista <a
href="TeachersController.html#M000071">administration</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000071-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000071-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 300</span>
300:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">administration</span>
301:     <span class="ruby-comment cmt"># lista degli user (docenti) già attivi ma che non sono associati a nessun corso di laurea</span>
302:     <span class="ruby-ivar">@not_associated_users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:graduate_courses</span>,
303:                 <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;specified_type = 'Teacher' AND graduate_courses.id IS null AND users.password is NOT null&quot;</span>])
304:               
305:     <span class="ruby-identifier">ids</span> = <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">graduate_course_ids</span>
306:     <span class="ruby-ivar">@graduate_courses</span> = <span class="ruby-constant">GraduateCourse</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:users</span>,
307:                 <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;specified_type = 'Teacher' AND users.password is NOT null AND graduate_courses.id IN (?)&quot;</span>,<span class="ruby-identifier">ids</span>])
308: 
309:     <span class="ruby-comment cmt"># lista degli users che non hanno ancora completato la registrazione</span>
310:     <span class="ruby-ivar">@not_active_users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">:graduate_courses</span>,
311:                 <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;users.password IS null AND graduate_courses.id IN (?)&quot;</span>,<span class="ruby-identifier">ids</span>])
312:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000065" class="method-detail">
        <a name="M000065"></a>

        <div class="method-heading">
          <a href="#M000065" class="method-signature">
          <span class="method-name">create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Gestisce il salvataggio nel DB del nuovo teacher invitato.
</p>
<ul>
<li>Se la mail passata come parametro (params[:mail]) non corrisponde a nessun
utente gia&#8217; registrato, viene gestita la creazione nel DB dei dati
relativi al teacher, allo user e al relativo address. Con la chiamata al
metodo TeacherMailer.deliver_activate_teacher viene in seguito spedita una
e-mail al docente invitato, in cui gli si da la possibilita&#8217; di
completare la registrazione al sistema inserendo i propri dati personali.

</li>
<li>Nel caso la mail passata come parametro (params[:mail]) corrisponda ad un
utente gia&#8217; registrato e il corso di laurea scelto per l&#8216;invito
(params[:graduate_course_id]) sia diverso da quello precedentemente
selezionato, il docente viene associato al nuovo corso di laurea
(mantenendo comunque l&#8216;associazione con quello precedente).

</li>
<li>Nel caso la mail passata come parametro (params[:mail]) corrisponda ad un
utente non di tipo teacher, viene segnalato l&#8216;errore.

</li>
</ul>
<p>
In tutti i casi, al termine delle operazioni viene fatto un redirect alla
vista <a href="TeachersController.html#M000064">new</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000065-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000065-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 161</span>
161:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>
162:     <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_mail</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:mail</span>])
163:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
164:      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
165:       <span class="ruby-ivar">@teacher</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span>()
166:       <span class="ruby-ivar">@teacher</span>.<span class="ruby-identifier">mail</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:mail</span>]
167:       <span class="ruby-ivar">@teacher</span>.<span class="ruby-identifier">random</span> = <span class="ruby-identifier">rand</span>(<span class="ruby-value">120</span>)
168:       <span class="ruby-identifier">t</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">new</span>()
169:       <span class="ruby-identifier">a</span> = <span class="ruby-constant">Address</span>.<span class="ruby-identifier">new</span>()
170:       <span class="ruby-identifier">t</span>.<span class="ruby-identifier">save</span>
171:       <span class="ruby-identifier">a</span>.<span class="ruby-identifier">save</span> <span class="ruby-keyword kw">false</span>
172:       <span class="ruby-ivar">@teacher</span>.<span class="ruby-identifier">specified</span> = <span class="ruby-identifier">t</span>
173:       <span class="ruby-ivar">@teacher</span>.<span class="ruby-identifier">address</span> = <span class="ruby-identifier">a</span>
174:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:graduate_course_id</span>]
175:         <span class="ruby-ivar">@teacher</span>.<span class="ruby-identifier">graduate_courses</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">GraduateCourse</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:graduate_course_id</span>])
176:       <span class="ruby-keyword kw">end</span>
177:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@teacher</span>.<span class="ruby-identifier">save</span>
178:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;Docente invitato con successo&quot;</span>
179:         <span class="ruby-constant">TeacherMailer</span>.<span class="ruby-identifier">deliver_activate_teacher</span>(<span class="ruby-ivar">@current_user</span>, <span class="ruby-ivar">@teacher</span>)
180:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>{<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">new_teacher_url</span>}
181:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{<span class="ruby-identifier">render</span>(<span class="ruby-identifier">:update</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">new_teacher_url</span>}}
182:       <span class="ruby-keyword kw">else</span>
183:         <span class="ruby-ivar">@graduate_courses</span> = <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">graduate_courses</span>
184:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>{<span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:new</span>}
185:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{}
186:         <span class="ruby-keyword kw">end</span>
187:       <span class="ruby-keyword kw">else</span>
188:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">own_by_teacher?</span>
189:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:graduate_course_id</span>]
190:             <span class="ruby-identifier">user</span>.<span class="ruby-identifier">graduate_courses</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">GraduateCourse</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:graduate_course_id</span>])
191:           <span class="ruby-keyword kw">end</span>
192:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;Docente invitato con successo&quot;</span>
193:           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>{<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">new_teacher_url</span>}
194:           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{<span class="ruby-identifier">render</span>(<span class="ruby-identifier">:update</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">new_teacher_url</span>}}
195:         <span class="ruby-keyword kw">else</span>
196:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:error</span>] = <span class="ruby-value str">&quot;La mail inserita è già presente e non corrisponde ad un docente&quot;</span>
197:           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>{<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">new_teacher_url</span>}
198:           <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{<span class="ruby-identifier">render</span>(<span class="ruby-identifier">:update</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">new_teacher_url</span>}}
199:         <span class="ruby-keyword kw">end</span>
200:       <span class="ruby-keyword kw">end</span>
201:     <span class="ruby-keyword kw">end</span>
202:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000073" class="method-detail">
        <a name="M000073"></a>

        <div class="method-heading">
          <a href="#M000073" class="method-signature">
          <span class="method-name">create_constraint</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Crea un nuovo temporal_constraints (vincolo) per il teacher loggato
caratterizzato dal parametro params[:id].
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000073-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000073-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 358</span>
358:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_constraint</span>
359:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">post?</span>
360:       <span class="ruby-identifier">day_nr</span> = <span class="ruby-identifier">from_dayname_to_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:day</span>])
361:       <span class="ruby-identifier">t</span> = <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:description=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:description</span>],
362:         <span class="ruby-identifier">:isHard=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>,<span class="ruby-identifier">:startHour=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:start_hour</span>],<span class="ruby-identifier">:endHour=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:end_hour</span>],<span class="ruby-identifier">:day=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">day_nr</span>)
363:       <span class="ruby-identifier">teacher</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
364:       <span class="ruby-ivar">@constraint</span> = <span class="ruby-identifier">t</span>
365:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">save</span>
366:         <span class="ruby-identifier">teacher</span>.<span class="ruby-identifier">constraints</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">t</span>
367:           <span class="ruby-ivar">@error_unique</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">t</span>.<span class="ruby-identifier">is_unique_constraint?</span>(<span class="ruby-identifier">teacher</span>)
368:       <span class="ruby-keyword kw">end</span>
369:         <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
370:         <span class="ruby-ivar">@teacher</span> = <span class="ruby-identifier">teacher</span>
371:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">edit_constraints</span>
372:                       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_constraints&quot;</span>
373:         }
374:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{}
375:       <span class="ruby-keyword kw">end</span>
376:     <span class="ruby-keyword kw">end</span>
377:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000076" class="method-detail">
        <a name="M000076"></a>

        <div class="method-heading">
          <a href="#M000076" class="method-signature">
          <span class="method-name">create_preference</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Crea un nuovo temporal_constraints (preferenza) per il teacher loggato
caratterizzato dal parametro params[:id].
</p>
<ul>
<li>Se non sono presenti altre preferenze nel sistema, il valore di isHard
della nuova preferenza sara&#8217; uguale a 1.

</li>
<li>Se sono gia&#8217; presenti altre preferenze, quella nuova verra&#8217;
inserita in coda alle altre gia&#8217; presenti, con priorita&#8217;
piu&#8217; bassa.

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000076-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000076-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 439</span>
439:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_preference</span>
440:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">post?</span>
441:       <span class="ruby-identifier">teacher</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
442:       <span class="ruby-identifier">day_nr</span> = <span class="ruby-identifier">from_dayname_to_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:day</span>])
443:       <span class="ruby-identifier">teacher_constraint_ids</span> = <span class="ruby-constant">ConstraintsOwner</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
444:           <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;constraint_type = 'TemporalConstraint' AND owner_type = 'Teacher' AND owner_id = (?)&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]],
445:           <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'constraint_id'</span>], <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'constraint_id'</span>)
446:       <span class="ruby-identifier">constraints</span> = []
447:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">id</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">teacher_constraint_ids</span> <span class="ruby-keyword kw">do</span>
448:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id</span>.<span class="ruby-identifier">constraint_id</span>).<span class="ruby-identifier">isHard</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
449:          <span class="ruby-identifier">constraints</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id</span>.<span class="ruby-identifier">constraint_id</span>)
450:         <span class="ruby-keyword kw">end</span>
451:       <span class="ruby-keyword kw">end</span>
452:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">constraints</span>.<span class="ruby-identifier">empty?</span>
453:         <span class="ruby-identifier">preference_value</span> = <span class="ruby-value">1</span>
454:       <span class="ruby-keyword kw">else</span>
455:         <span class="ruby-identifier">preference_value</span> = <span class="ruby-identifier">constraints</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> <span class="ruby-comment cmt">#conto il numero delle preferenze nel db e metto la giusta priorità a quella nuova</span>
456:       <span class="ruby-keyword kw">end</span>
457:       <span class="ruby-identifier">t</span> = <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:description=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;Preferenza docente: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">teacher</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">teacher</span>.<span class="ruby-identifier">surname</span>,
458:         <span class="ruby-identifier">:isHard=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">preference_value</span>,<span class="ruby-identifier">:startHour=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:start_hour</span>],<span class="ruby-identifier">:endHour=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:end_hour</span>],<span class="ruby-identifier">:day=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">day_nr</span>)
459:       <span class="ruby-ivar">@constraint</span> = <span class="ruby-identifier">t</span>
460:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">save</span>
461:         <span class="ruby-identifier">teacher</span>.<span class="ruby-identifier">constraints</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">t</span>
462:           <span class="ruby-ivar">@error_unique</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">t</span>.<span class="ruby-identifier">is_unique_constraint?</span>(<span class="ruby-identifier">teacher</span>)
463:       <span class="ruby-keyword kw">end</span>
464:       <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
465:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">edit_preferences</span>
466:                       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_preferences&quot;</span>
467:         }
468:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{ <span class="ruby-identifier">edit_preferences</span> }
469:       <span class="ruby-keyword kw">end</span>
470:     <span class="ruby-keyword kw">end</span>
471:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000066" class="method-detail">
        <a name="M000066"></a>

        <div class="method-heading">
          <a href="#M000066" class="method-signature">
          <span class="method-name">destroy</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Elimina definitivamente dal sistema il teacher (e il relativo user) passato
come parametro (params[:id]) Al termine della cancellazione viene fatto un
redirect alla vista <a
href="TeachersController.html#M000071">administration</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000066-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000066-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 206</span>
206:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy</span>
207:     <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:address</span>,
208:             <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;specified_type = 'Teacher' AND specified_id = (?)&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]])
209:     <span class="ruby-ivar">@teacher</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">specified_id</span>)
210:     <span class="ruby-ivar">@teacher</span>.<span class="ruby-identifier">destroy</span>
211:     <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">address</span>.<span class="ruby-identifier">destroy</span>
212:     <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">destroy</span>
213:     <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">administration_teachers_url</span>)
214:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000074" class="method-detail">
        <a name="M000074"></a>

        <div class="method-heading">
          <a href="#M000074" class="method-signature">
          <span class="method-name">destroy_constraint</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Elimina definitivamente il temporal_constraints (vincolo) identificato dal
parametro params[:constraint_id]
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000074-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000074-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 380</span>
380:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy_constraint</span>
381:     <span class="ruby-identifier">constraint_to_destroy</span> = <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:constraint_id</span>])
382:     <span class="ruby-identifier">constraint_to_destroy</span>.<span class="ruby-identifier">destroy</span>
383:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
384:       <span class="ruby-ivar">@constraint</span> = <span class="ruby-identifier">constraint_to_destroy</span>
385:       <span class="ruby-comment cmt">#necessario per controllo `size` su js</span>
386:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">edit_constraints</span>
387:                     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_constraints&quot;</span>}
388:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span> { <span class="ruby-identifier">edit_constraints</span> }
389:     <span class="ruby-keyword kw">end</span>
390:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000081" class="method-detail">
        <a name="M000081"></a>

        <div class="method-heading">
          <a href="#M000081" class="method-signature">
          <span class="method-name">destroy_constraint_from_manage_constraints</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Elimina definitivamente il temporal_constraints passato come parametro,
facendo in seguito un redirect alla vista <a
href="TeachersController.html#M000071">administration</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000081-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000081-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 606</span>
606:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy_constraint_from_manage_constraints</span>
607:     <span class="ruby-identifier">constraint_to_destroy</span> = <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:constraint_id</span>])
608:     <span class="ruby-identifier">constraint_to_destroy</span>.<span class="ruby-identifier">destroy</span>
609:     <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">administration_teachers_url</span>)
610:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000077" class="method-detail">
        <a name="M000077"></a>

        <div class="method-heading">
          <a href="#M000077" class="method-signature">
          <span class="method-name">destroy_preference</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Elimina definitivamente il temporal_constraints (preferenza) identificato
dal parametro params[:constraint_id]. Se la cancellazione va a buon fine, i
valori di isHard delle altre preferenze vengono aggiornati per ritornare ad
essere una sequenza di interi crescenti (partendo da 1).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000077-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000077-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 476</span>
476:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy_preference</span>
477:     <span class="ruby-identifier">constraint_to_destroy</span> = <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:constraint_id</span>])
478:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">constraint_to_destroy</span>.<span class="ruby-identifier">destroy</span> <span class="ruby-comment cmt">#eliminando una preferenza vanno aggiornate le priorità delle altre preferenze</span>
479:       <span class="ruby-identifier">teacher_constraint_ids</span> = <span class="ruby-constant">ConstraintsOwner</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
480:           <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;constraint_type = 'TemporalConstraint' AND owner_type = 'Teacher' AND owner_id = (?)&quot;</span>, 
481:             <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:teacher_id</span>]], <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'constraint_id'</span>)
482:       <span class="ruby-identifier">constraints</span> = []
483:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">tc</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">teacher_constraint_ids</span> <span class="ruby-keyword kw">do</span>
484:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">tc</span>.<span class="ruby-identifier">constraint_id</span>).<span class="ruby-identifier">isHard</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
485:          <span class="ruby-identifier">constraints</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">tc</span>.<span class="ruby-identifier">constraint_id</span>)
486:         <span class="ruby-keyword kw">end</span>
487:       <span class="ruby-keyword kw">end</span>
488:       <span class="ruby-identifier">constraints</span> = <span class="ruby-identifier">constraints</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>[<span class="ruby-identifier">:isHard</span>] }
489:       <span class="ruby-identifier">i</span> = <span class="ruby-value">1</span>
490:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">constraints</span> <span class="ruby-keyword kw">do</span>
491:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">isHard</span> = <span class="ruby-identifier">i</span>
492:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
493:         <span class="ruby-identifier">i</span> = <span class="ruby-identifier">i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
494:       <span class="ruby-keyword kw">end</span>
495:     <span class="ruby-keyword kw">end</span>
496:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
497:       <span class="ruby-ivar">@constraint</span> = <span class="ruby-identifier">constraint_to_destroy</span>
498:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">edit_preferences</span>
499:                     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_preferences&quot;</span>
500:       }
501:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{ <span class="ruby-identifier">edit_preferences</span> }
502:       <span class="ruby-keyword kw">end</span>
503:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000067" class="method-detail">
        <a name="M000067"></a>

        <div class="method-heading">
          <a href="#M000067" class="method-signature">
          <span class="method-name">edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Inizializza la variabile d&#8216;istanza @user per la vista <a
href="TeachersController.html#M000067">edit</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000067-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000067-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 217</span>
217:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit</span>
218:     <span class="ruby-identifier">teacher</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
219:     <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:address</span>,
220:             <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;specified_type = 'Teacher' AND specified_id = (?)&quot;</span>, <span class="ruby-identifier">teacher</span>.<span class="ruby-identifier">id</span>])
221:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000061" class="method-detail">
        <a name="M000061"></a>

        <div class="method-heading">
          <a href="#M000061" class="method-signature">
          <span class="method-name">edit_capabilities</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Inizializza le variabili d&#8216;istanza @teacher, @manageable_capabilities
e @selectable_capabilities per la vista <a
href="TeachersController.html#M000061">edit_capabilities</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000061-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000061-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 89</span>
89:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_capabilities</span>
90:     <span class="ruby-identifier">total_capabilities</span> = <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">capabilities</span>
91:     <span class="ruby-ivar">@teacher</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
92:     <span class="ruby-identifier">teacher_capabilities</span> = <span class="ruby-ivar">@teacher</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">capabilities</span>
93:     <span class="ruby-ivar">@manageable_capabilities</span> = <span class="ruby-identifier">total_capabilities</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">teacher_capabilities</span>
94:     <span class="ruby-ivar">@selectable_capabilities</span> = <span class="ruby-identifier">total_capabilities</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">teacher_capabilities</span>
95:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000072" class="method-detail">
        <a name="M000072"></a>

        <div class="method-heading">
          <a href="#M000072" class="method-signature">
          <span class="method-name">edit_constraints</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Inizializza le variabili d&#8216;istanza @teacher e @constraints per la
vista <a href="TeachersController.html#M000072">edit_constraints</a>, in
cui il teacher loggato puo&#8217; gestire i suoi temporal_constraints, i
vincoli temporali di non disponibilita&#8217;.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000072-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000072-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 316</span>
316:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_constraints</span>
317:     <span class="ruby-ivar">@teacher</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
318:     <span class="ruby-identifier">teacher_constraint_ids</span> = <span class="ruby-constant">ConstraintsOwner</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
319:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;constraint_type = 'TemporalConstraint' AND owner_type = 'Teacher' AND owner_id = (?)&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]],
320:       <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'constraint_id'</span>], <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'constraint_id'</span>)
321:     <span class="ruby-ivar">@constraints</span> = []
322:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">id</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">teacher_constraint_ids</span> <span class="ruby-keyword kw">do</span>
323:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id</span>.<span class="ruby-identifier">constraint_id</span>).<span class="ruby-identifier">isHard</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
324:         <span class="ruby-ivar">@constraints</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id</span>.<span class="ruby-identifier">constraint_id</span>)
325:       <span class="ruby-keyword kw">end</span>
326:     <span class="ruby-keyword kw">end</span>
327:     <span class="ruby-comment cmt"># Aggiunta parte per mostrare l'expirydate #</span>
328:     <span class="ruby-identifier">total_graduate_courses</span> = <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">graduate_courses</span>
329:     <span class="ruby-identifier">teacher</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
330:     <span class="ruby-identifier">teacher_graduate_courses</span> = <span class="ruby-identifier">teacher</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">graduate_courses</span>
331:     <span class="ruby-ivar">@manageable_graduate_courses</span> = <span class="ruby-identifier">total_graduate_courses</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">teacher_graduate_courses</span>
332:     <span class="ruby-ivar">@expiry_dates</span> = []
333:     <span class="ruby-ivar">@number_of_real_expiry_dates</span> = <span class="ruby-value">0</span>
334:     <span class="ruby-ivar">@manageable_graduate_courses</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">mgc</span><span class="ruby-operator">|</span>
335:       <span class="ruby-identifier">exp_date</span> = <span class="ruby-constant">ExpiryDate</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:graduate_course_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">mgc</span>.<span class="ruby-identifier">id</span>})
336:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">exp_date</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span>
337:         <span class="ruby-identifier">first_exp_date</span> = <span class="ruby-identifier">exp_date</span>.<span class="ruby-identifier">first</span>
338:         <span class="ruby-identifier">first_exp_date</span> = <span class="ruby-keyword kw">nil</span>
339:         <span class="ruby-identifier">exp_date</span> = <span class="ruby-identifier">exp_date</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>[<span class="ruby-value str">'date'</span>] }
340:         <span class="ruby-identifier">exp_date</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ed</span><span class="ruby-operator">|</span>
341:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ed</span>.<span class="ruby-identifier">date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>()
342:             <span class="ruby-identifier">first_exp_date</span> = <span class="ruby-identifier">ed</span>
343:             <span class="ruby-keyword kw">break</span>
344:           <span class="ruby-keyword kw">end</span>
345:         <span class="ruby-keyword kw">end</span>
346:         <span class="ruby-ivar">@expiry_dates</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">first_exp_date</span>
347:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">first_exp_date</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
348:           <span class="ruby-ivar">@number_of_real_expiry_dates</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
349:         <span class="ruby-keyword kw">end</span>
350:       <span class="ruby-keyword kw">else</span>
351:         <span class="ruby-ivar">@expiry_dates</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">nil</span>
352:       <span class="ruby-keyword kw">end</span>
353:     <span class="ruby-keyword kw">end</span>
354:     <span class="ruby-comment cmt"># Fine parte expirydate #</span>
355:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000060" class="method-detail">
        <a name="M000060"></a>

        <div class="method-heading">
          <a href="#M000060" class="method-signature">
          <span class="method-name">edit_graduate_courses</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Inizializza le variabili d&#8216;istanza @teacher,
@manageable_graduate_courses e @selectable_graduate_courses per la vista <a
href="TeachersController.html#M000060">edit_graduate_courses</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000060-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000060-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 80</span>
80:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_graduate_courses</span>
81:     <span class="ruby-identifier">total_graduate_courses</span> = <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">graduate_courses</span>
82:     <span class="ruby-ivar">@teacher</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
83:     <span class="ruby-identifier">teacher_graduate_courses</span> = <span class="ruby-ivar">@teacher</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">graduate_courses</span>
84:     <span class="ruby-ivar">@manageable_graduate_courses</span> = <span class="ruby-identifier">total_graduate_courses</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">teacher_graduate_courses</span>
85:     <span class="ruby-ivar">@selectable_graduate_courses</span> = <span class="ruby-identifier">total_graduate_courses</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">teacher_graduate_courses</span>
86:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000075" class="method-detail">
        <a name="M000075"></a>

        <div class="method-heading">
          <a href="#M000075" class="method-signature">
          <span class="method-name">edit_preferences</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Inizializza le variabili d&#8216;istanza @teacher e @constraints per la
vista <a href="TeachersController.html#M000075">edit_preferences</a>, in
cui il teacher loggato puo&#8217; gestire le sue preferenze temporali di
non disponibilita&#8217;.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000075-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000075-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 394</span>
394:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_preferences</span>
395:     <span class="ruby-ivar">@teacher</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
396:     <span class="ruby-identifier">teacher_constraint_ids</span> = <span class="ruby-constant">ConstraintsOwner</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
397:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;constraint_type = 'TemporalConstraint' AND owner_type = 'Teacher' AND owner_id = (?)&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]],
398:       <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'constraint_id'</span>], <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'constraint_id'</span>)
399:     <span class="ruby-ivar">@constraints</span> = []
400:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">id</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">teacher_constraint_ids</span> <span class="ruby-keyword kw">do</span>
401:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id</span>.<span class="ruby-identifier">constraint_id</span>).<span class="ruby-identifier">isHard</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
402:         <span class="ruby-ivar">@constraints</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id</span>.<span class="ruby-identifier">constraint_id</span>)
403:       <span class="ruby-keyword kw">end</span>
404:     <span class="ruby-keyword kw">end</span>
405:     <span class="ruby-ivar">@constraints</span> = <span class="ruby-ivar">@constraints</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>[<span class="ruby-identifier">:isHard</span>] }
406:     <span class="ruby-comment cmt"># Aggiunta parte per mostrare l'expirydate #</span>
407:     <span class="ruby-identifier">total_graduate_courses</span> = <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">graduate_courses</span>
408:     <span class="ruby-identifier">teacher</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
409:     <span class="ruby-identifier">teacher_graduate_courses</span> = <span class="ruby-identifier">teacher</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">graduate_courses</span>
410:     <span class="ruby-ivar">@manageable_graduate_courses</span> = <span class="ruby-identifier">total_graduate_courses</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">teacher_graduate_courses</span>
411:     <span class="ruby-ivar">@expiry_dates</span> = []
412:     <span class="ruby-ivar">@number_of_real_expiry_dates</span> = <span class="ruby-value">0</span>
413:     <span class="ruby-ivar">@manageable_graduate_courses</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">mgc</span><span class="ruby-operator">|</span>
414:       <span class="ruby-identifier">exp_date</span> = <span class="ruby-constant">ExpiryDate</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:graduate_course_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">mgc</span>.<span class="ruby-identifier">id</span>})
415:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">exp_date</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span>
416:         <span class="ruby-identifier">first_exp_date</span> = <span class="ruby-identifier">exp_date</span>.<span class="ruby-identifier">first</span>
417:         <span class="ruby-identifier">first_exp_date</span> = <span class="ruby-keyword kw">nil</span>
418:         <span class="ruby-identifier">exp_date</span> = <span class="ruby-identifier">exp_date</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>[<span class="ruby-value str">'date'</span>] }
419:         <span class="ruby-identifier">exp_date</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ed</span><span class="ruby-operator">|</span>
420:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ed</span>.<span class="ruby-identifier">date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>()
421:             <span class="ruby-identifier">first_exp_date</span> = <span class="ruby-identifier">ed</span>
422:             <span class="ruby-keyword kw">break</span>
423:           <span class="ruby-keyword kw">end</span>
424:         <span class="ruby-keyword kw">end</span>
425:         <span class="ruby-ivar">@expiry_dates</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">first_exp_date</span>
426:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">first_exp_date</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
427:           <span class="ruby-ivar">@number_of_real_expiry_dates</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
428:         <span class="ruby-keyword kw">end</span>
429:       <span class="ruby-keyword kw">else</span>
430:         <span class="ruby-ivar">@expiry_dates</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">nil</span>
431:       <span class="ruby-keyword kw">end</span>
432:     <span class="ruby-keyword kw">end</span>
433:     <span class="ruby-comment cmt"># Fine parte expirydate #</span>
434:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000058" class="method-detail">
        <a name="M000058"></a>

        <div class="method-heading">
          <a href="#M000058" class="method-signature">
          <span class="method-name">index</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Inizializza la variabile d&#8216;istanza @teachers per la vista <a
href="TeachersController.html#M000058">index</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000058-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000058-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 40</span>
40:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">index</span>
41:     <span class="ruby-ivar">@graduate_courses</span> = <span class="ruby-constant">GraduateCourse</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:users</span>,
42:                 <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;specified_type = 'Teacher' AND users.password is NOT null&quot;</span>])
43:     <span class="ruby-ivar">@teachers</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
44:     <span class="ruby-ivar">@graduate_courses</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span>
45:       <span class="ruby-identifier">g</span>.<span class="ruby-identifier">users</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">u</span><span class="ruby-operator">|</span>
46:         <span class="ruby-ivar">@teachers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">u</span>.<span class="ruby-identifier">specified</span>
47:       <span class="ruby-keyword kw">end</span>
48:     <span class="ruby-keyword kw">end</span>
49:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
50:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
51:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@teachers</span>.<span class="ruby-identifier">to_xml</span>(<span class="ruby-identifier">:except</span> =<span class="ruby-operator">&gt;</span>[<span class="ruby-identifier">:created_at</span>, <span class="ruby-identifier">:updated_at</span>]) }
52:     <span class="ruby-keyword kw">end</span>
53:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000080" class="method-detail">
        <a name="M000080"></a>

        <div class="method-heading">
          <a href="#M000080" class="method-signature">
          <span class="method-name">manage_constraints</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Inizializza le variabili d&#8216;istanza @teacher, @constraints e
@preferences per la vista <a
href="TeachersController.html#M000080">manage_constraints</a>, la quale
permette di gestire i vincoli e le preferenze del docente passato come
parametro (params[:id]).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000080-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000080-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 584</span>
584:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">manage_constraints</span>
585:     <span class="ruby-ivar">@teacher</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
586:     <span class="ruby-identifier">teacher_constraint_ids</span> = <span class="ruby-constant">ConstraintsOwner</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
587:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;constraint_type = 'TemporalConstraint' AND owner_type = 'Teacher' AND owner_id = (?)&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]],
588:       <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'constraint_id'</span>], <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'constraint_id'</span>)
589:     <span class="ruby-ivar">@constraints</span> = []
590:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c_id</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">teacher_constraint_ids</span> <span class="ruby-keyword kw">do</span>
591:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">c_id</span>.<span class="ruby-identifier">constraint_id</span>).<span class="ruby-identifier">isHard</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
592:         <span class="ruby-ivar">@constraints</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">c_id</span>.<span class="ruby-identifier">constraint_id</span>)
593:       <span class="ruby-keyword kw">end</span>
594:     <span class="ruby-keyword kw">end</span>
595:     <span class="ruby-ivar">@preferences</span> = []
596:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">p_id</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">teacher_constraint_ids</span> <span class="ruby-keyword kw">do</span>
597:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">p_id</span>.<span class="ruby-identifier">constraint_id</span>).<span class="ruby-identifier">isHard</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
598:         <span class="ruby-ivar">@preferences</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">p_id</span>.<span class="ruby-identifier">constraint_id</span>)
599:       <span class="ruby-keyword kw">end</span>
600:     <span class="ruby-keyword kw">end</span>
601:     <span class="ruby-ivar">@preferences</span> = <span class="ruby-ivar">@preferences</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>[<span class="ruby-identifier">:isHard</span>] }
602:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000064" class="method-detail">
        <a name="M000064"></a>

        <div class="method-heading">
          <a href="#M000064" class="method-signature">
          <span class="method-name">new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Crea una nuova variabile d&#8216;istanza vuota @teacher e inizializza
@graduate_courses per la vista <a
href="TeachersController.html#M000064">new</a>, in cui e&#8217; possibile
invitare un docente inserendo il suo indirizzo email.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000064-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000064-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 144</span>
144:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new</span>
145:     <span class="ruby-ivar">@teacher</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span>()
146:     <span class="ruby-ivar">@graduate_courses</span> = <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">graduate_courses</span>
147:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000069" class="method-detail">
        <a name="M000069"></a>

        <div class="method-heading">
          <a href="#M000069" class="method-signature">
          <span class="method-name">pre_activate</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Inizializza le variabili d&#8216;istanza @user e @repeat_password per la
vista <a href="TeachersController.html#M000069">pre_activate</a>, in cui un
teacher puo&#8217; completare la propria registrazione al sistema.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000069-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000069-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 249</span>
249:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pre_activate</span>
250:     <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
251:     <span class="ruby-ivar">@repeat_password</span> = <span class="ruby-value">1</span>
252:     <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@user</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">specified_type</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Teacher&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">active?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">digest</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:digest</span>]
253:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;Questo docente è già attivo o non esiste&quot;</span>
254:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">timetables_url</span>
255:     <span class="ruby-keyword kw">end</span>
256:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000059" class="method-detail">
        <a name="M000059"></a>

        <div class="method-heading">
          <a href="#M000059" class="method-signature">
          <span class="method-name">show</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Inizializza le variabili d&#8216;istanza @teacher e @user per la vista <a
href="TeachersController.html#M000059">show</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000059-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000059-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 56</span>
56:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show</span>
57:     <span class="ruby-identifier">notfound</span> = <span class="ruby-keyword kw">false</span>
58:     <span class="ruby-ivar">@teacher</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]) <span class="ruby-keyword kw">rescue</span> <span class="ruby-identifier">notfound</span> = <span class="ruby-keyword kw">true</span>
59:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">notfound</span>
60:       <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:address</span>,
61:               <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;specified_type = 'Teacher' AND specified_id = (?)&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]])
62:     <span class="ruby-keyword kw">end</span>
63:       <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
64:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> {
65:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">notfound</span>
66:             <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'timetables'</span>, <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'not_found'</span>
67:           <span class="ruby-keyword kw">end</span>
68:           }
69:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml</span> {
70:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">notfound</span>
71:             <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'timetables'</span>, <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'not_found'</span>
72:           <span class="ruby-keyword kw">else</span>
73:             <span class="ruby-identifier">render</span> <span class="ruby-identifier">:xml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">to_xml</span>(<span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:address</span>], <span class="ruby-identifier">:except</span> =<span class="ruby-operator">&gt;</span>[<span class="ruby-identifier">:created_at</span>, <span class="ruby-identifier">:updated_at</span>, <span class="ruby-identifier">:digest</span>, <span class="ruby-identifier">:password</span>, <span class="ruby-identifier">:random</span>])
74:           <span class="ruby-keyword kw">end</span>
75:         }
76:     <span class="ruby-keyword kw">end</span>
77:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000079" class="method-detail">
        <a name="M000079"></a>

        <div class="method-heading">
          <a href="#M000079" class="method-signature">
          <span class="method-name">teacher_preference_priority_down</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Diminuisce la priorita&#8217; della preferenza passata come parametro
(params[:constraint_id]): il valore di isHard aumenta di 1, in quanto una
priorita&#8217; piu&#8217; bassa e&#8217; caratterizzata da un valore di
isHard piu&#8217; alto. Se invece la preferenza ha gia&#8217;
priorita&#8217; minima non avvengono modifiche.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000079-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000079-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 546</span>
546:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">teacher_preference_priority_down</span>
547:     <span class="ruby-identifier">constraint_to_move_down</span> = <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:constraint_id</span>]) <span class="ruby-comment cmt">#preferenza di cui cambiare la priorità</span>
548:     <span class="ruby-identifier">teacher_constraint_ids</span> = <span class="ruby-constant">ConstraintsOwner</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
549:           <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;constraint_type = 'TemporalConstraint' AND owner_type = 'Teacher' AND owner_id = (?)&quot;</span>,
550:           <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:teacher_id</span>]], <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'constraint_id'</span>)
551:     <span class="ruby-identifier">constraints</span> = []
552:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">tc</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">teacher_constraint_ids</span> <span class="ruby-keyword kw">do</span>
553:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">tc</span>.<span class="ruby-identifier">constraint_id</span>).<span class="ruby-identifier">isHard</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
554:          <span class="ruby-identifier">constraints</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">tc</span>.<span class="ruby-identifier">constraint_id</span>)
555:       <span class="ruby-keyword kw">end</span>
556:     <span class="ruby-keyword kw">end</span>
557:     <span class="ruby-identifier">constraints</span> = <span class="ruby-identifier">constraints</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>[<span class="ruby-identifier">:isHard</span>] }
558:     <span class="ruby-identifier">max_priority</span> = <span class="ruby-identifier">constraints</span>.<span class="ruby-identifier">size</span>
559:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">constraint_to_move_down</span>.<span class="ruby-identifier">isHard</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">max_priority</span> <span class="ruby-comment cmt">#la preferenza è l'ultima, non devo fare niente</span>
560:       <span class="ruby-identifier">already_down</span> = <span class="ruby-keyword kw">true</span>
561:     <span class="ruby-keyword kw">else</span>
562:       <span class="ruby-identifier">already_down</span> = <span class="ruby-keyword kw">false</span>
563:       <span class="ruby-identifier">i</span> = <span class="ruby-identifier">constraint_to_move_down</span>.<span class="ruby-identifier">isHard</span>
564:       <span class="ruby-identifier">c1</span> = <span class="ruby-identifier">constraints</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>] <span class="ruby-comment cmt">#c1 è la preferenza di cui devo diminuire la priorità</span>
565:       <span class="ruby-identifier">c1</span>.<span class="ruby-identifier">isHard</span> = (<span class="ruby-identifier">constraint_to_move_down</span>.<span class="ruby-identifier">isHard</span>)<span class="ruby-operator">+</span><span class="ruby-value">1</span> <span class="ruby-comment cmt">#imposto il nuovo valore di priorità</span>
566:       <span class="ruby-identifier">c2</span> = <span class="ruby-identifier">constraints</span>[<span class="ruby-identifier">i</span>] <span class="ruby-comment cmt">#c2 è la preferenze di cui devo diminuire la priorità, perchè il suo posto è stato preso da c1</span>
567:       <span class="ruby-identifier">c2</span>.<span class="ruby-identifier">isHard</span> = (<span class="ruby-identifier">constraint_to_move_down</span>.<span class="ruby-identifier">isHard</span>) <span class="ruby-comment cmt">#imposto la nuova priorità, il nuovo valore equivale al vecchio + 1</span>
568:       <span class="ruby-identifier">c1</span>.<span class="ruby-identifier">save</span>
569:       <span class="ruby-identifier">c2</span>.<span class="ruby-identifier">save</span>
570:     <span class="ruby-keyword kw">end</span>
571:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
572:       <span class="ruby-ivar">@constraint_up</span> = <span class="ruby-identifier">c2</span>
573:       <span class="ruby-ivar">@constraint_down</span> = <span class="ruby-identifier">c1</span>
574:       <span class="ruby-ivar">@already_down</span> = <span class="ruby-identifier">already_down</span>
575:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">edit_preferences</span>
576:                     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_preferences&quot;</span>
577:       }
578:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{<span class="ruby-identifier">edit_preferences</span>}
579:     <span class="ruby-keyword kw">end</span>
580:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000078" class="method-detail">
        <a name="M000078"></a>

        <div class="method-heading">
          <a href="#M000078" class="method-signature">
          <span class="method-name">teacher_preference_priority_up</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Aumenta la priorita&#8217; della preferenza passata come parametro
(params[:constraint_id]): il valore di isHard diminuisce di 1, in quanto
una priorita&#8217; piu&#8217; alta e&#8217; caratterizzata da un valore di
isHard piu&#8217; basso. Se invece la preferenza ha gia&#8217;
priorita&#8217; massima (isHard == 1) non avvengono modifiche.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000078-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000078-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 508</span>
508:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">teacher_preference_priority_up</span>
509:     <span class="ruby-identifier">constraint_to_move_up</span> = <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:constraint_id</span>]) <span class="ruby-comment cmt">#preferenza di cui cambiare la priorità</span>
510:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">constraint_to_move_up</span>.<span class="ruby-identifier">isHard</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-comment cmt">#la preferenza è la prima, non devo cambiare niente</span>
511:       <span class="ruby-identifier">already_up</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-comment cmt">#tiz: non ho trovato altra soluzione per non modifcare il codice</span>
512:     <span class="ruby-keyword kw">else</span>
513:       <span class="ruby-identifier">already_up</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-comment cmt">#tiz: non ho trovato altra soluzione per non modifcare il codice</span>
514:       <span class="ruby-identifier">teacher_constraint_ids</span> = <span class="ruby-constant">ConstraintsOwner</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
515:           <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;constraint_type = 'TemporalConstraint' AND owner_type = 'Teacher' AND owner_id = (?)&quot;</span>,
516:           <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:teacher_id</span>]], <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'constraint_id'</span>)
517:       <span class="ruby-identifier">constraints</span> = []
518:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">tc</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">teacher_constraint_ids</span> <span class="ruby-keyword kw">do</span>
519:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">tc</span>.<span class="ruby-identifier">constraint_id</span>).<span class="ruby-identifier">isHard</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
520:          <span class="ruby-identifier">constraints</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">tc</span>.<span class="ruby-identifier">constraint_id</span>)
521:         <span class="ruby-keyword kw">end</span>
522:       <span class="ruby-keyword kw">end</span>
523:       <span class="ruby-identifier">i</span> =  <span class="ruby-identifier">constraint_to_move_up</span>.<span class="ruby-identifier">isHard</span>
524:       <span class="ruby-identifier">constraints</span> = <span class="ruby-identifier">constraints</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>[<span class="ruby-identifier">:isHard</span>] } <span class="ruby-comment cmt">#lista ordinata per priorità crescente delle preferenze</span>
525:       <span class="ruby-identifier">c1</span> = <span class="ruby-identifier">constraints</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>] <span class="ruby-comment cmt">#c1 è la preferenza di cui devo aumentare la priorità</span>
526:       <span class="ruby-identifier">c1</span>.<span class="ruby-identifier">isHard</span> = <span class="ruby-identifier">i</span><span class="ruby-operator">-</span><span class="ruby-value">1</span> <span class="ruby-comment cmt">#imposto il nuovo valore di priorità</span>
527:       <span class="ruby-identifier">c2</span> = <span class="ruby-identifier">constraints</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">-</span><span class="ruby-value">2</span>] <span class="ruby-comment cmt">#c2 è la preferenze di cui devo diminuire la priorità, perchè il suo posto è stato preso da c1</span>
528:       <span class="ruby-identifier">c2</span>.<span class="ruby-identifier">isHard</span> = <span class="ruby-identifier">i</span> <span class="ruby-comment cmt">#imposto la nuova priorità, il nuovo valore equivale al vecchio + 1</span>
529:       <span class="ruby-identifier">c1</span>.<span class="ruby-identifier">save</span>
530:       <span class="ruby-identifier">c2</span>.<span class="ruby-identifier">save</span>
531:     <span class="ruby-keyword kw">end</span>
532:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
533:       <span class="ruby-ivar">@constraint_up</span> = <span class="ruby-identifier">c1</span>
534:       <span class="ruby-ivar">@constraint_down</span> = <span class="ruby-identifier">c2</span>
535:       <span class="ruby-ivar">@already_up</span> = <span class="ruby-identifier">already_up</span>
536:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">edit_preferences</span>
537:                     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_preferences&quot;</span>
538:       }
539:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{<span class="ruby-identifier">edit_preferences</span>}
540:     <span class="ruby-keyword kw">end</span>
541:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000082" class="method-detail">
        <a name="M000082"></a>

        <div class="method-heading">
          <a href="#M000082" class="method-signature">
          <span class="method-name">transform_constraint_in_preference</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Trasformare il temporal_constraints (vincolo) passato come parametro in una
preferenza. La nuova preferenza ha priorita&#8217; massima: il valore
isHard di tutte le preferenze precedentemente inserite viene aumentato di
1.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000082-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000082-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 615</span>
615:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">transform_constraint_in_preference</span>
616:     <span class="ruby-identifier">teacher</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:teacher</span>])
617:     <span class="ruby-identifier">constraint_to_transform_in_preference</span> = <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:constraint_id</span>])
618:     <span class="ruby-identifier">teacher_constraint_ids</span> = <span class="ruby-constant">ConstraintsOwner</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
619:           <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;constraint_type = 'TemporalConstraint' AND owner_type = 'Teacher' AND owner_id = (?)&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:teacher</span>]],
620:           <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'constraint_id'</span>], <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'constraint_id'</span>)
621:     <span class="ruby-constant">TeacherMailer</span>.<span class="ruby-identifier">deliver_constraint_in_preference</span>(<span class="ruby-ivar">@current_user</span>,<span class="ruby-identifier">teacher</span>.<span class="ruby-identifier">user</span>,<span class="ruby-identifier">constraint_to_transform_in_preference</span>)
622:     <span class="ruby-identifier">preferences</span> = []
623:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">id</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">teacher_constraint_ids</span> <span class="ruby-keyword kw">do</span>
624:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id</span>.<span class="ruby-identifier">constraint_id</span>).<span class="ruby-identifier">isHard</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
625:        <span class="ruby-identifier">preferences</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">TemporalConstraint</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id</span>.<span class="ruby-identifier">constraint_id</span>)
626:       <span class="ruby-keyword kw">end</span>
627:     <span class="ruby-keyword kw">end</span>
628:     <span class="ruby-identifier">preferences</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
629:       <span class="ruby-identifier">p</span>.<span class="ruby-identifier">isHard</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">isHard</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
630:       <span class="ruby-identifier">p</span>.<span class="ruby-identifier">save</span>
631:     <span class="ruby-keyword kw">end</span>
632:     <span class="ruby-identifier">constraint_to_transform_in_preference</span>.<span class="ruby-identifier">isHard</span> = <span class="ruby-value">1</span>
633:     <span class="ruby-identifier">constraint_to_transform_in_preference</span>.<span class="ruby-identifier">description</span> = <span class="ruby-value str">&quot;Preferenza docente: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">teacher</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">teacher</span>.<span class="ruby-identifier">surname</span>
634:     <span class="ruby-identifier">constraint_to_transform_in_preference</span>.<span class="ruby-identifier">save</span>
635:     <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">administration_teachers_url</span>)
636:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000063" class="method-detail">
        <a name="M000063"></a>

        <div class="method-heading">
          <a href="#M000063" class="method-signature">
          <span class="method-name">update_capabilities</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Gestisce le associazioni tra i teachers e le capability.
</p>
<ul>
<li>Se la chiamata e&#8217; una delete, viene eliminato il riferimento tra il
docente passato come parametro (params[:id]) e il privilegio
(params[:ids]).

</li>
<li>Se la chiamata e&#8217; un put, viene creata l&#8216;associazione tra il
docente e il privilegio.

</li>
</ul>
<p>
In entrambi i casi, al termine del metodo viene fatto un redirect alla
vista <a href="TeachersController.html#M000061">edit_capabilities</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000063-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000063-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 126</span>
126:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_capabilities</span>
127:     <span class="ruby-ivar">@teacher</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
128:     <span class="ruby-ivar">@capability</span> = <span class="ruby-constant">Capability</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:ids</span>])
129:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">delete?</span>
130:       <span class="ruby-ivar">@teacher</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">capabilities</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-ivar">@capability</span>)
131:     <span class="ruby-keyword kw">end</span>
132:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">put?</span>
133:       <span class="ruby-ivar">@teacher</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">capabilities</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-ivar">@capability</span>)
134:     <span class="ruby-keyword kw">end</span>
135:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
136:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">edit_capabilities</span>
137:                     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_capabilities&quot;</span>}
138:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span> {<span class="ruby-identifier">edit_capabilities</span>}
139:     <span class="ruby-keyword kw">end</span>
140:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000062" class="method-detail">
        <a name="M000062"></a>

        <div class="method-heading">
          <a href="#M000062" class="method-signature">
          <span class="method-name">update_graduate_courses</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Gestisce le associazioni tra i teachers e i graduate_courses.
</p>
<ul>
<li>Se la chiamata e&#8217; una delete, viene eliminato il riferimento tra il
docente passato come parametro (params[:id]) e il corso di laurea
(params[:ids]).

</li>
<li>Se la chiamata e&#8217; un put, viene creata l&#8216;associazione tra il
docente e il corso di laurea.

</li>
</ul>
<p>
In entrambi i casi, al termine del metodo viene fatto un redirect alla
vista <a href="TeachersController.html#M000060">edit_graduate_courses</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000062-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000062-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 102</span>
102:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_graduate_courses</span>
103:     <span class="ruby-ivar">@teacher</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
104:     <span class="ruby-ivar">@graduate_course</span> = <span class="ruby-constant">GraduateCourse</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:ids</span>])
105:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">delete?</span>
106:       <span class="ruby-ivar">@teacher</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">graduate_courses</span>.<span class="ruby-identifier">delete</span>( <span class="ruby-ivar">@graduate_course</span>)
107:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@teacher</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">graduate_courses</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
108:          <span class="ruby-ivar">@teacher</span>.<span class="ruby-identifier">teachings</span>.<span class="ruby-identifier">delete_all</span>
109:       <span class="ruby-keyword kw">end</span>
110:     <span class="ruby-keyword kw">end</span>
111:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">put?</span>
112:       <span class="ruby-ivar">@teacher</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">graduate_courses</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-ivar">@graduate_course</span>)
113:     <span class="ruby-keyword kw">end</span>
114:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
115:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> {<span class="ruby-identifier">edit_graduate_courses</span>
116:                   <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_graduate_courses&quot;</span>}
117:       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span> {<span class="ruby-identifier">edit_graduate_courses</span>}
118:     <span class="ruby-keyword kw">end</span>
119:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000068" class="method-detail">
        <a name="M000068"></a>

        <div class="method-heading">
          <a href="#M000068" class="method-signature">
          <span class="method-name">update_personal_data</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Aggiorna i campi dato dell&#8216;address del teacher passato come parametro
(params[:id]).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000068-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000068-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/teachers_controller.rb, line 224</span>
224:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_personal_data</span>
225:     <span class="ruby-identifier">teacher</span> = <span class="ruby-constant">Teacher</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
226:     <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:address</span>,
227:             <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;specified_type = 'Teacher' AND specified_id = (?)&quot;</span>, <span class="ruby-identifier">teacher</span>.<span class="ruby-identifier">id</span>])
228:     <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">address</span>.<span class="ruby-identifier">city</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:city</span>]
229:     <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">address</span>.<span class="ruby-identifier">street</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:street</span>]
230:     <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">address</span>.<span class="ruby-identifier">telephone</span>= <span class="ruby-value str">&quot;&quot;</span>
231:     <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:prefisso</span>] <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:telefono</span>] <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span>)
232:       <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">address</span>.<span class="ruby-identifier">telephone</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:prefisso</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot;-&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:telefono</span>]
233:     <span class="ruby-keyword kw">end</span>
234:     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
235:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">address</span>.<span class="ruby-identifier">save</span>
236:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">'Dati personali aggiornati correttamente'</span>
237:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>{<span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">timetables_url</span>)}
238:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{<span class="ruby-identifier">render</span>(<span class="ruby-identifier">:update</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">timetables_url</span>}}
239:       <span class="ruby-keyword kw">else</span>
240:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:error</span>] = <span class="ruby-value str">&quot;Errore nell'aggiornamento dei dati personali&quot;</span>
241:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>{<span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'edit'</span>}
242:         <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{}
243:       <span class="ruby-keyword kw">end</span>
244:     <span class="ruby-keyword kw">end</span>
245:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>